<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>机器视觉每日资讯（聚类版）</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles/base.css">
  <style>
    :root { --bar-bg:#0b3d66; --accent:#0d84ff; --badge:#17a34a; font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body { margin:0; background:#f5f7fa; }
    header { background:var(--bar-bg); color:#fff; padding:10px 16px; display:flex; align-items:center; justify-content:space-between;}
    header h1 { font-size:18px; margin:0; font-weight:600; }
    .toolbar { background:#fff; padding:10px 16px; display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end; border-bottom:1px solid #e2e8f0;}
    .toolbar .group { display:flex; flex-direction:column; font-size:12px; color:#555;}
    .toolbar input[type=range] { width:180px; }
    .toolbar button, .llm-panel button { cursor:pointer; border:1px solid #ccc; background:#fff; padding:4px 10px; border-radius:6px; font-size:12px; }
    .toolbar button.primary { background:var(--accent); color:#fff; border:none; }
    #clusters { padding:16px; display:grid; gap:16px; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); }
    .cluster-card { background:#fff; border:1px solid #e2e8f0; border-radius:12px; padding:14px 16px; display:flex; flex-direction:column; gap:8px; position:relative;}
    .cluster-card h3 { margin:0 0 2px; font-size:16px; line-height:1.3; }
    .llm-badge { display:inline-block; background:var(--badge); color:#fff; font-size:10px; padding:2px 6px; border-radius:10px; margin-left:6px;}
    .sources { list-style:none; padding:0; margin:0; font-size:12px; max-height:140px; overflow:auto;}
    .sources li { margin:2px 0; line-height:1.3; }
    .actions { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap;}
    .actions button { font-size:12px; }
    .stats-line { font-size:12px; color:#444; margin-left:auto; display:flex; gap:10px; align-items:center;}
    .flex-row { display:flex; gap:14px; align-items:center; flex-wrap:wrap;}
    .llm-panel { background:#fff; margin:0 16px 0; padding:12px 16px; border-bottom:1px solid #e2e8f0; display:none; flex-wrap:wrap; gap:14px;}
    .llm-panel.visible { display:flex; }
    .llm-panel .field { display:flex; flex-direction:column; font-size:12px; min-width:170px;}
    .llm-panel input { padding:4px 6px; font-size:12px; }
    .progress { font-size:12px; color:#666; }
    .error { color:#c62828; font-size:12px; }
    .tag-badge { background:#eef3f8; color:#234; font-size:11px; padding:2px 6px; border-radius:8px; margin:2px 4px 0 0; display:inline-block;}
  </style>
</head>
<body>
  <header>
    <h1>机器视觉每日资讯（聚类版）</h1>
    <div style="display:flex; gap:8px;">
      <button id="legacyBtn">旧版列表</button>
      <a href="prompt.html" style="color:#fff;font-size:12px;text-decoration:none;align-self:center;">旧 Prompt 入口</a>
    </div>
  </header>

  <div class="toolbar" id="clusterToolbar">
    <div class="group">
      <label>相似度阈值 (<span id="thVal">0.88</span>)</label>
      <input id="thresholdInput" type="range" min="0.75" max="0.95" step="0.01" value="0.88">
    </div>
    <div class="group">
      <label><input type="checkbox" id="titleMergeChk"> 启用标题二次合并</label>
      <small style="color:#777;">>0.92 标题相似</small>
    </div>
    <div class="group flex-row" style="align-items:flex-end;">
      <button id="reclusterBtn" class="primary">重新聚类</button>
      <button id="clearCacheBtn">清空缓存</button>
      <button id="toggleLLMBtn">LLM 设置面板</button>
    </div>
    <div class="stats-line" id="statsLine">
      <span id="statRaw">Raw: -</span>
      <span id="statClusters">Clusters: -</span>
      <span id="statEnhanced">LLM: -</span>
    </div>
  </div>

  <div class="llm-panel" id="llmPanel">
    <div class="field">
      <label>API Base</label>
      <input id="llmBase" placeholder="https://api.openai.com">
    </div>
    <div class="field">
      <label>API Key</label>
      <input id="llmKey" type="password" placeholder="sk-...">
    </div>
    <div class="field">
      <label>Model</label>
      <input id="llmModel" placeholder="gpt-4o-mini">
    </div>
    <div class="field">
      <label>Batch Size</label>
      <input id="llmBatch" type="number" min="1" max="20" value="4">
    </div>
    <div class="field" style="justify-content:flex-end;flex-direction:row;gap:8px;align-items:flex-end;">
      <button id="saveLLMBtn" class="primary">保存配置</button>
      <button id="runLLMEnhanceBtn">批量增强未优化事件</button>
    </div>
    <div class="field" style="flex:1; min-width:240px;">
      <label>进度</label>
      <div class="progress" id="llmProgress">未开始</div>
      <div class="error" id="llmError"></div>
    </div>
  </div>

  <main>
    <div id="clusters"></div>
  </main>

  <!-- 入口脚本：外部化后的唯一引用 -->
  <script type="module" src="./app.js"></script>
</body>
</html>
