<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="手帐风提示词生成器 - 基于机器视觉新闻生成精美的学习卡片提示词">
    <title>提示词生成器 - 机器视觉每日资讯</title>
    
    <!-- 外部样式表 -->
    <link rel="stylesheet" href="styles/base.css">
    
    <!-- 图标 -->
    <link rel="icon" type="image/svg+xml" href="assets/logo-placeholder.svg">
    
    <style>
        .prompt-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .prompt-section {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }
        
        .news-selector {
            margin-bottom: var(--spacing-lg);
        }
        
        .form-group {
            margin-bottom: var(--spacing-md);
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }
        
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: border-color var(--transition-fast);
        }
        
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .selected-news-preview {
            background: var(--surface-secondary);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            border-left: 4px solid var(--primary);
            margin: var(--spacing-md) 0;
        }
        
        .news-preview-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }
        
        .news-preview-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        
        .news-preview-summary {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        
        .news-preview-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .prompt-output {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            min-height: 400px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-y: auto;
            color: var(--text-primary);
        }
        
        .copy-button {
            margin-top: var(--spacing-md);
        }
        
        .copy-success {
            color: var(--success);
            font-size: 0.875rem;
            margin-left: var(--spacing-sm);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .copy-success.show {
            opacity: 1;
        }
        
        .instructions {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text-inverse);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        
        .instructions h3 {
            margin-bottom: var(--spacing-md);
        }
        
        .instructions ul {
            margin-left: var(--spacing-lg);
        }
        
        .instructions li {
            margin-bottom: var(--spacing-sm);
        }
        
        @media (max-width: 768px) {
            .prompt-container {
                padding: var(--spacing-md);
            }
            
            .prompt-section {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- 网站头部 -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section">
                <img src="assets/logo-placeholder.svg" alt="网站标识" class="logo">
                <h1 class="site-title">提示词生成器</h1>
            </div>
            
            <nav aria-label="主导航">
                <a href="index.html" class="btn btn-secondary">返回首页</a>
            </nav>
        </div>
    </header>
    
    <!-- 主要内容区域 -->
    <main class="main-content">
        <div class="prompt-container">
            <!-- 使用说明 -->
            <section class="instructions">
                <h3>📝 使用说明</h3>
                <ul>
                    <li>选择一条新闻作为生成源</li>
                    <li>添加个人补充说明（可选）</li>
                    <li>点击"生成提示词"按钮</li>
                    <li>复制生成的提示词到AI工具中使用</li>
                    <li>推荐AI引擎：GPT-4, Claude, 文心一言等</li>
                </ul>
            </section>
            
            <!-- 新闻选择 -->
            <section class="prompt-section">
                <h2 class="mb-md">选择新闻</h2>
                
                <div class="form-group">
                    <label for="newsSelect" class="form-label">新闻列表</label>
                    <select id="newsSelect" class="form-select" onchange="updatePreview()">
                        <option value="">请选择一条新闻...</option>
                    </select>
                </div>
                
                <div id="newsPreview" class="selected-news-preview" style="display: none;">
                    <!-- 新闻预览内容将在这里显示 -->
                </div>
                
                <div class="form-group">
                    <label for="customNotes" class="form-label">补充说明 (可选)</label>
                    <textarea 
                        id="customNotes" 
                        class="form-textarea" 
                        placeholder="在这里添加您的个人见解、相关知识点或学习重点..."
                    ></textarea>
                </div>
                
                <button id="generateBtn" class="btn btn-primary" onclick="generatePrompt()">
                    ✨ 生成提示词
                </button>
            </section>
            
            <!-- 提示词输出 -->
            <section class="prompt-section">
                <h2 class="mb-md">生成的提示词</h2>
                
                <div id="promptOutput" class="prompt-output">
                    生成的提示词将在这里显示...
                </div>
                
                <div class="copy-button">
                    <button id="copyBtn" class="btn btn-primary" onclick="copyPrompt()" style="display: none;">
                        📋 复制提示词
                    </button>
                    <span id="copySuccess" class="copy-success">已复制到剪贴板！</span>
                </div>
            </section>
        </div>
    </main>
    
    <!-- 页脚 -->
    <footer class="text-center mt-lg" style="padding: 2rem; color: var(--text-muted); font-size: 0.875rem;">
        <p>&copy; 2024 机器视觉每日资讯. 智能提示词生成系统.</p>
    </footer>
    
    <script>
        let newsData = [];
        let promptTemplate = '';
        
        // 初始化应用
        async function init() {
            await loadNewsData();
            await loadPromptTemplate();
            checkDeepLink();
            setupAutoLogo();
        }
        
        // 自动检测并设置logo
        async function setupAutoLogo() {
            const logoOptions = [
                'assets/company-logo.png',
                'assets/company-logo.svg',
                'assets/logo-placeholder.svg'
            ];
            
            for (const logoPath of logoOptions) {
                try {
                    const response = await fetch(logoPath, { method: 'HEAD' });
                    if (response.ok) {
                        const logoElements = document.querySelectorAll('.logo');
                        logoElements.forEach(logo => {
                            logo.src = logoPath;
                            logo.alt = '网站标识';
                        });
                        break;
                    }
                } catch (error) {
                    console.warn(`无法加载logo: ${logoPath}`);
                }
            }
        }
        
        // 加载新闻数据
        async function loadNewsData() {
            try {
                const response = await fetch('data/news.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                newsData = await response.json();
                populateNewsSelect();
                console.log(`加载了 ${newsData.length} 条新闻`);
            } catch (error) {
                console.error('加载新闻数据失败:', error);
                showError('无法加载新闻数据，请稍后重试');
            }
        }
        
        // 加载提示词模板
        async function loadPromptTemplate() {
            try {
                const response = await fetch('prompts/handbook-note-prompt.md');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                promptTemplate = await response.text();
                console.log('提示词模板加载成功');
            } catch (error) {
                console.error('加载提示词模板失败:', error);
                showError('无法加载提示词模板，请稍后重试');
            }
        }
        
        // 填充新闻选择器
        function populateNewsSelect() {
            const select = document.getElementById('newsSelect');
            select.innerHTML = '<option value="">请选择一条新闻...</option>';
            
            newsData.forEach(news => {
                const option = document.createElement('option');
                option.value = news.id;
                option.textContent = news.title;
                select.appendChild(option);
            });
        }
        
        // 检查深度链接
        function checkDeepLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const preselectedId = urlParams.get('id');
            
            if (preselectedId) {
                const select = document.getElementById('newsSelect');
                select.value = preselectedId;
                updatePreview();
                
                // 平滑滚动到新闻选择区域
                setTimeout(() => {
                    document.querySelector('.prompt-section').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }
        
        // 更新新闻预览
        function updatePreview() {
            const select = document.getElementById('newsSelect');
            const preview = document.getElementById('newsPreview');
            const selectedId = select.value;
            
            if (!selectedId) {
                preview.style.display = 'none';
                return;
            }
            
            const selectedNews = newsData.find(news => news.id === selectedId);
            if (!selectedNews) {
                preview.style.display = 'none';
                return;
            }
            
            const formattedDate = formatDate(selectedNews.date);
            const tagsHtml = selectedNews.tags.map(tag => 
                `<span class="tag solid">${escapeHtml(tag)}</span>`
            ).join('');
            
            preview.innerHTML = `
                <div class="news-preview-title">${escapeHtml(selectedNews.title)}</div>
                <div class="news-preview-meta">
                    <strong>来源:</strong> ${escapeHtml(selectedNews.source)} | 
                    <strong>日期:</strong> ${formattedDate}
                </div>
                <div class="news-preview-summary">
                    <strong>摘要:</strong> ${escapeHtml(selectedNews.summary)}
                </div>
                <div class="news-preview-tags">
                    <strong>标签:</strong> ${tagsHtml}
                </div>
            `;
            
            preview.style.display = 'block';
        }
        
        // 生成提示词
        function generatePrompt() {
            const selectedId = document.getElementById('newsSelect').value;
            const customNotes = document.getElementById('customNotes').value.trim();
            
            if (!selectedId) {
                alert('请先选择一条新闻');
                return;
            }
            
            const selectedNews = newsData.find(news => news.id === selectedId);
            if (!selectedNews) {
                alert('未找到选中的新闻');
                return;
            }
            
            const formattedDate = formatDate(selectedNews.date);
            const tagsString = selectedNews.tags.join(', ');
            
            // 替换模板变量
            let generatedPrompt = promptTemplate
                .replace(/\{\{title\}\}/g, selectedNews.title)
                .replace(/\{\{source\}\}/g, selectedNews.source)
                .replace(/\{\{date\}\}/g, formattedDate)
                .replace(/\{\{summary\}\}/g, selectedNews.summary)
                .replace(/\{\{tags\}\}/g, tagsString);
            
            // 添加自定义补充说明
            if (customNotes) {
                generatedPrompt += `\n\n## 💭 补充说明\n${customNotes}`;
            }
            
            // 显示生成的提示词
            const outputElement = document.getElementById('promptOutput');
            outputElement.textContent = generatedPrompt;
            
            // 显示复制按钮
            document.getElementById('copyBtn').style.display = 'inline-block';
            
            // 滚动到输出区域
            outputElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            console.log('提示词生成成功');
        }
        
        // 复制提示词到剪贴板
        async function copyPrompt() {
            const promptText = document.getElementById('promptOutput').textContent;
            
            if (!promptText || promptText === '生成的提示词将在这里显示...') {
                alert('没有可复制的内容');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(promptText);
                
                // 显示成功提示
                const successElement = document.getElementById('copySuccess');
                successElement.classList.add('show');
                
                setTimeout(() => {
                    successElement.classList.remove('show');
                }, 2000);
                
                console.log('提示词已复制到剪贴板');
            } catch (error) {
                console.error('复制失败:', error);
                
                // 备用复制方法
                const textarea = document.createElement('textarea');
                textarea.value = promptText;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('已复制到剪贴板');
                } catch (fallbackError) {
                    alert('复制失败，请手动选择文本复制');
                }
                
                document.body.removeChild(textarea);
            }
        }
        
        // 格式化日期
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return '未知日期';
            }
        }
        
        // HTML转义
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 显示错误信息
        function showError(message) {
            const outputElement = document.getElementById('promptOutput');
            outputElement.textContent = `错误: ${message}`;
            outputElement.style.color = 'var(--error)';
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>