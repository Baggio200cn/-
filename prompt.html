<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ‰‹å¸é£æç¤ºè¯ç”Ÿæˆå™¨ - åŸºäºæœºå™¨è§†è§‰æ–°é—»ç”Ÿæˆç²¾ç¾çš„å­¦ä¹ å¡ç‰‡æç¤ºè¯">
    <title>æç¤ºè¯ç”Ÿæˆå™¨ - æœºå™¨è§†è§‰æ¯æ—¥èµ„è®¯</title>
    
    <!-- å¤–éƒ¨æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="styles/base.css">
    
    <!-- å›¾æ ‡ -->
    <link rel="icon" type="image/svg+xml" href="assets/logo-placeholder.svg">
    
    <style>
        .prompt-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .prompt-section {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
        }
        
        .news-selector {
            margin-bottom: var(--spacing-lg);
        }
        
        .form-group {
            margin-bottom: var(--spacing-md);
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }
        
        .form-select,
        .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            transition: border-color var(--transition-fast);
        }
        
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .selected-news-preview {
            background: var(--surface-secondary);
            border-radius: var(--radius);
            padding: var(--spacing-md);
            border-left: 4px solid var(--primary);
            margin: var(--spacing-md) 0;
        }
        
        .news-preview-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
        }
        
        .news-preview-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        
        .news-preview-summary {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }
        
        .news-preview-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .prompt-output {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            min-height: 400px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.6;
            white-space: pre-wrap;
            overflow-y: auto;
            color: var(--text-primary);
        }
        
        .copy-button {
            margin-top: var(--spacing-md);
        }
        
        .copy-success {
            color: var(--success);
            font-size: 0.875rem;
            margin-left: var(--spacing-sm);
            opacity: 0;
            transition: opacity var(--transition-fast);
        }
        
        .copy-success.show {
            opacity: 1;
        }
        
        .instructions {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text-inverse);
            border-radius: var(--radius);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        
        .instructions h3 {
            margin-bottom: var(--spacing-md);
        }
        
        .instructions ul {
            margin-left: var(--spacing-lg);
        }
        
        .instructions li {
            margin-bottom: var(--spacing-sm);
        }
        
        @media (max-width: 768px) {
            .prompt-container {
                padding: var(--spacing-md);
            }
            
            .prompt-section {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- ç½‘ç«™å¤´éƒ¨ -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section">
                <img src="assets/logo-placeholder.svg" alt="ç½‘ç«™æ ‡è¯†" class="logo">
                <h1 class="site-title">æç¤ºè¯ç”Ÿæˆå™¨</h1>
            </div>
            
            <nav aria-label="ä¸»å¯¼èˆª">
                <a href="index.html" class="btn btn-secondary">è¿”å›é¦–é¡µ</a>
            </nav>
        </div>
    </header>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <div class="prompt-container">
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <section class="instructions">
                <h3>ğŸ“ ä½¿ç”¨è¯´æ˜</h3>
                <ul>
                    <li>é€‰æ‹©ä¸€æ¡æ–°é—»ä½œä¸ºç”Ÿæˆæº</li>
                    <li>æ·»åŠ ä¸ªäººè¡¥å……è¯´æ˜ï¼ˆå¯é€‰ï¼‰</li>
                    <li>ç‚¹å‡»"ç”Ÿæˆæç¤ºè¯"æŒ‰é’®</li>
                    <li>å¤åˆ¶ç”Ÿæˆçš„æç¤ºè¯åˆ°AIå·¥å…·ä¸­ä½¿ç”¨</li>
                    <li>æ¨èAIå¼•æ“ï¼šGPT-4, Claude, æ–‡å¿ƒä¸€è¨€ç­‰</li>
                </ul>
            </section>
            
            <!-- æ–°é—»é€‰æ‹© -->
            <section class="prompt-section">
                <h2 class="mb-md">é€‰æ‹©æ–°é—»</h2>
                
                <div class="form-group">
                    <label for="newsSelect" class="form-label">æ–°é—»åˆ—è¡¨</label>
                    <select id="newsSelect" class="form-select" onchange="updatePreview()">
                        <option value="">è¯·é€‰æ‹©ä¸€æ¡æ–°é—»...</option>
                    </select>
                </div>
                
                <div id="newsPreview" class="selected-news-preview" style="display: none;">
                    <!-- æ–°é—»é¢„è§ˆå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                
                <div class="form-group">
                    <label for="customNotes" class="form-label">è¡¥å……è¯´æ˜ (å¯é€‰)</label>
                    <textarea 
                        id="customNotes" 
                        class="form-textarea" 
                        placeholder="åœ¨è¿™é‡Œæ·»åŠ æ‚¨çš„ä¸ªäººè§è§£ã€ç›¸å…³çŸ¥è¯†ç‚¹æˆ–å­¦ä¹ é‡ç‚¹..."
                    ></textarea>
                </div>
                
                <button id="generateBtn" class="btn btn-primary" onclick="generatePrompt()">
                    âœ¨ ç”Ÿæˆæç¤ºè¯
                </button>
            </section>
            
            <!-- æç¤ºè¯è¾“å‡º -->
            <section class="prompt-section">
                <h2 class="mb-md">ç”Ÿæˆçš„æç¤ºè¯</h2>
                
                <div id="promptOutput" class="prompt-output">
                    ç”Ÿæˆçš„æç¤ºè¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
                </div>
                
                <div class="copy-button">
                    <button id="copyBtn" class="btn btn-primary" onclick="copyPrompt()" style="display: none;">
                        ğŸ“‹ å¤åˆ¶æç¤ºè¯
                    </button>
                    <span id="copySuccess" class="copy-success">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</span>
                </div>
            </section>
        </div>
    </main>
    
    <!-- é¡µè„š -->
    <footer class="text-center mt-lg" style="padding: 2rem; color: var(--text-muted); font-size: 0.875rem;">
        <p>&copy; 2024 æœºå™¨è§†è§‰æ¯æ—¥èµ„è®¯. æ™ºèƒ½æç¤ºè¯ç”Ÿæˆç³»ç»Ÿ.</p>
    </footer>
    
    <script>
        let newsData = [];
        let promptTemplate = '';
        
        // åˆå§‹åŒ–åº”ç”¨
        async function init() {
            await loadNewsData();
            await loadPromptTemplate();
            checkDeepLink();
            setupAutoLogo();
        }
        
        // è‡ªåŠ¨æ£€æµ‹å¹¶è®¾ç½®logo
        async function setupAutoLogo() {
            const logoOptions = [
                'assets/company-logo.png',
                'assets/company-logo.svg',
                'assets/logo-placeholder.svg'
            ];
            
            for (const logoPath of logoOptions) {
                try {
                    const response = await fetch(logoPath, { method: 'HEAD' });
                    if (response.ok) {
                        const logoElements = document.querySelectorAll('.logo');
                        logoElements.forEach(logo => {
                            logo.src = logoPath;
                            logo.alt = 'ç½‘ç«™æ ‡è¯†';
                        });
                        break;
                    }
                } catch (error) {
                    console.warn(`æ— æ³•åŠ è½½logo: ${logoPath}`);
                }
            }
        }
        
        // åŠ è½½æ–°é—»æ•°æ®
        async function loadNewsData() {
            try {
                const response = await fetch('data/news.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                newsData = await response.json();
                populateNewsSelect();
                console.log(`åŠ è½½äº† ${newsData.length} æ¡æ–°é—»`);
            } catch (error) {
                console.error('åŠ è½½æ–°é—»æ•°æ®å¤±è´¥:', error);
                showError('æ— æ³•åŠ è½½æ–°é—»æ•°æ®ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // åŠ è½½æç¤ºè¯æ¨¡æ¿
        async function loadPromptTemplate() {
            try {
                const response = await fetch('prompts/handbook-note-prompt.md');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                promptTemplate = await response.text();
                console.log('æç¤ºè¯æ¨¡æ¿åŠ è½½æˆåŠŸ');
            } catch (error) {
                console.error('åŠ è½½æç¤ºè¯æ¨¡æ¿å¤±è´¥:', error);
                showError('æ— æ³•åŠ è½½æç¤ºè¯æ¨¡æ¿ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // å¡«å……æ–°é—»é€‰æ‹©å™¨
        function populateNewsSelect() {
            const select = document.getElementById('newsSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©ä¸€æ¡æ–°é—»...</option>';
            
            newsData.forEach(news => {
                const option = document.createElement('option');
                option.value = news.id;
                option.textContent = news.title;
                select.appendChild(option);
            });
        }
        
        // æ£€æŸ¥æ·±åº¦é“¾æ¥
        function checkDeepLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const preselectedId = urlParams.get('id');
            
            if (preselectedId) {
                const select = document.getElementById('newsSelect');
                select.value = preselectedId;
                updatePreview();
                
                // å¹³æ»‘æ»šåŠ¨åˆ°æ–°é—»é€‰æ‹©åŒºåŸŸ
                setTimeout(() => {
                    document.querySelector('.prompt-section').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            }
        }
        
        // æ›´æ–°æ–°é—»é¢„è§ˆ
        function updatePreview() {
            const select = document.getElementById('newsSelect');
            const preview = document.getElementById('newsPreview');
            const selectedId = select.value;
            
            if (!selectedId) {
                preview.style.display = 'none';
                return;
            }
            
            const selectedNews = newsData.find(news => news.id === selectedId);
            if (!selectedNews) {
                preview.style.display = 'none';
                return;
            }
            
            const formattedDate = formatDate(selectedNews.date);
            const tagsHtml = selectedNews.tags.map(tag => 
                `<span class="tag solid">${escapeHtml(tag)}</span>`
            ).join('');
            
            preview.innerHTML = `
                <div class="news-preview-title">${escapeHtml(selectedNews.title)}</div>
                <div class="news-preview-meta">
                    <strong>æ¥æº:</strong> ${escapeHtml(selectedNews.source)} | 
                    <strong>æ—¥æœŸ:</strong> ${formattedDate}
                </div>
                <div class="news-preview-summary">
                    <strong>æ‘˜è¦:</strong> ${escapeHtml(selectedNews.summary)}
                </div>
                <div class="news-preview-tags">
                    <strong>æ ‡ç­¾:</strong> ${tagsHtml}
                </div>
            `;
            
            preview.style.display = 'block';
        }
        
        // ç”Ÿæˆæç¤ºè¯
        function generatePrompt() {
            const selectedId = document.getElementById('newsSelect').value;
            const customNotes = document.getElementById('customNotes').value.trim();
            
            if (!selectedId) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€æ¡æ–°é—»');
                return;
            }
            
            const selectedNews = newsData.find(news => news.id === selectedId);
            if (!selectedNews) {
                alert('æœªæ‰¾åˆ°é€‰ä¸­çš„æ–°é—»');
                return;
            }
            
            const formattedDate = formatDate(selectedNews.date);
            const tagsString = selectedNews.tags.join(', ');
            
            // æ›¿æ¢æ¨¡æ¿å˜é‡
            let generatedPrompt = promptTemplate
                .replace(/\{\{title\}\}/g, selectedNews.title)
                .replace(/\{\{source\}\}/g, selectedNews.source)
                .replace(/\{\{date\}\}/g, formattedDate)
                .replace(/\{\{summary\}\}/g, selectedNews.summary)
                .replace(/\{\{tags\}\}/g, tagsString);
            
            // æ·»åŠ è‡ªå®šä¹‰è¡¥å……è¯´æ˜
            if (customNotes) {
                generatedPrompt += `\n\n## ğŸ’­ è¡¥å……è¯´æ˜\n${customNotes}`;
            }
            
            // æ˜¾ç¤ºç”Ÿæˆçš„æç¤ºè¯
            const outputElement = document.getElementById('promptOutput');
            outputElement.textContent = generatedPrompt;
            
            // æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®
            document.getElementById('copyBtn').style.display = 'inline-block';
            
            // æ»šåŠ¨åˆ°è¾“å‡ºåŒºåŸŸ
            outputElement.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
            
            console.log('æç¤ºè¯ç”ŸæˆæˆåŠŸ');
        }
        
        // å¤åˆ¶æç¤ºè¯åˆ°å‰ªè´´æ¿
        async function copyPrompt() {
            const promptText = document.getElementById('promptOutput').textContent;
            
            if (!promptText || promptText === 'ç”Ÿæˆçš„æç¤ºè¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...') {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(promptText);
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                const successElement = document.getElementById('copySuccess');
                successElement.classList.add('show');
                
                setTimeout(() => {
                    successElement.classList.remove('show');
                }, 2000);
                
                console.log('æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                
                // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                const textarea = document.createElement('textarea');
                textarea.value = promptText;
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                } catch (fallbackError) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
                }
                
                document.body.removeChild(textarea);
            }
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return 'æœªçŸ¥æ—¥æœŸ';
            }
        }
        
        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const outputElement = document.getElementById('promptOutput');
            outputElement.textContent = `é”™è¯¯: ${message}`;
            outputElement.style.color = 'var(--error)';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>